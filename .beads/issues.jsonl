{"id":"ouroboros-1","title":"High: Extract shared provider parser and retry helpers (parsing.ts, retry.ts)","description":"Duplicate parser/util helpers exist across adapters. Move firstStringValue and retry regex out of provider modules into shared parsing.ts + retry.ts; keep adapters thin mappings. Sources: codex.ts:13,21,265; claude.ts:9,37,191; copilot.ts:9,17,136.","notes":"Plan: verify provider adapters only call shared providers/parsing.ts and providers/retry.ts helpers, then close as umbrella complete with summary in session notes.","status":"closed","priority":0,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:00:00.5886551-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:22:30.0188288-08:00","closed_at":"2026-02-17T02:22:30.0188288-08:00","close_reason":"Done: all provider parser/retry helpers are already centralized and adapters now rely on shared parsing/retry modules via prior dependent beads (1.1/1.2/1.3/1.4). No additional code changes required; verified via repo scan.","labels":["refactor","provider"],"dependencies":[{"issue_id":"ouroboros-1","depends_on_id":"ouroboros-1.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-1","depends_on_id":"ouroboros-1.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-1","depends_on_id":"ouroboros-1.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-1","depends_on_id":"ouroboros-1.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-1","depends_on_id":"ouroboros-6.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-1","depends_on_id":"ouroboros-6.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-1.1","title":"Extract providers/parsing.ts shared parser helpers","description":"Create shared parsing helpers (safe parse candidates + firstStringValue/object guards) for provider adapters.","notes":"Completed: shared providers/parsing.ts now contains safeJsonParse + toJsonCandidates + isRecord + provider-specific firstStringValue keys. Updated codex/claude/copilot adapters to consume shared helpers; removed duplicated codex JSON-candidate parser; copilot now also uses shared JSON candidate extraction. Verified with: bunx biome check providers/parsing.ts providers/codex.ts providers/claude.ts providers/copilot.ts.","status":"closed","priority":0,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:20.8948001-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:12:59.0179158-08:00","closed_at":"2026-02-17T01:11:26.6575704-08:00","close_reason":"Shared parsing helpers extracted and wired into provider adapters; targeted lint check passes for parsing/adapters.","labels":["refactor","provider"],"dependencies":[{"issue_id":"ouroboros-1.1","depends_on_id":"ouroboros-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-1.2","title":"Extract providers/retry.ts shared retry-delay extraction helpers","description":"Create shared retry delay parser for seconds/minutes and structured payload extraction.","notes":"Verified complete: shared retry helper exists in providers/retry.ts with structured key traversal + regex fallback parsing; codex/claude/copilot adapters now all delegate extractRetryDelaySeconds to extractRetryDelayFromOutput. Verified with bunx biome check providers/retry.ts providers/parsing.ts providers/codex.ts providers/claude.ts providers/copilot.ts.","status":"closed","priority":0,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:21.5100341-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:13:54.8261948-08:00","closed_at":"2026-02-17T01:13:21.7898095-08:00","close_reason":"Shared retry-delay extraction helper implemented and provider adapters migrated/validated.","labels":["refactor","provider"],"dependencies":[{"issue_id":"ouroboros-1.2","depends_on_id":"ouroboros-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-1.3","title":"Migrate codex/claude/copilot adapters to shared parsing/retry helpers","description":"Replace duplicated helper implementations in provider adapters with imports from parsing.ts/retry.ts.","notes":"Plan: migrate codex.ts, claude.ts, and copilot.ts to shared parsing/retry helpers in providers/parsing.ts and providers/retry.ts; eliminate duplicated logic, keep behavior unchanged.","status":"closed","priority":0,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:22.1171217-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:15:59.4515623-08:00","closed_at":"2026-02-17T01:15:59.4515623-08:00","close_reason":"Completed parsing/retry helper consolidation for adapters (codex, claude, copilot), shared toPositiveNumber/collectRawJsonLines in providers/parsing and removed duplicate local implementations.","labels":["refactor","provider"],"dependencies":[{"issue_id":"ouroboros-1.3","depends_on_id":"ouroboros-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-1.3","depends_on_id":"ouroboros-1.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-1.3","depends_on_id":"ouroboros-1.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-1.4","title":"Provider parser/retry parity smoke-check and cleanup","description":"Validate behavior parity for preview extraction, retry delays, and no-beads markers after migration.","notes":"Plan: run a parity smoke-check across provider parsing/retry paths; verify no behavior regressions in preview extraction, retry delays, and no-beads markers after shared helper migrations; remove only low-risk cleanup if duplicates remain.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:22.7661389-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:21:17.3963201-08:00","closed_at":"2026-02-17T01:21:17.3963201-08:00","close_reason":"Provider parity cleanup complete: centralized no-beads marker detection in parsing helper and removed duplicated marker checks in all adapters.","labels":["refactor","provider","verification"],"dependencies":[{"issue_id":"ouroboros-1.4","depends_on_id":"ouroboros-1","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-1.4","depends_on_id":"ouroboros-1.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-2","title":"High: Extract shared live-run state/model for ANSI and Ink renderers","description":"State machine logic duplicated between terminal-ui.ts and tui.tsx (types/handlers/concepts). Extract live-run-state.ts as shared store/model, keep renderer-specific view code in each implementation, preserve renderer parity where sensible.","notes":"Plan: scan terminal-ui.ts and tui.tsx for duplicated live-run state logic, then route remaining shared derivations through core/live-run-state selectors/helpers; keep renderer-only code unchanged and preserve visible behavior.","status":"closed","priority":0,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:00:04.8562915-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:41:17.7232596-08:00","closed_at":"2026-02-17T01:41:17.7232596-08:00","close_reason":"Shared live-run model now consumed by both renderers (ANSI and Ink): shared state selectors/transitions in core/live-run-state drive all status derivations, rendering paths remain renderer-local. No additional state-model duplication found.","labels":["refactor","tui"],"dependencies":[{"issue_id":"ouroboros-2","depends_on_id":"ouroboros-2.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-2","depends_on_id":"ouroboros-2.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-2","depends_on_id":"ouroboros-2.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-2","depends_on_id":"ouroboros-2.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-2","depends_on_id":"ouroboros-2.5","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-2.1","title":"Audit remaining duplicated live-run state logic across renderers","description":"Map current duplication between core/terminal-ui.ts and tui/tui.tsx versus core/live-run-state.ts.","notes":"Plan: Audit remaining duplicated live-run state logic across renderers, compare implementations in all active loop renderers, extract the smallest safe shared abstraction, and update docs/comments if needed.\nCompleted: shared live-run state is now consumed by both terminal and Ink renderers. Both renderers now use LiveRunStateStore from core/live-run-state, removing duplicated update/queue/launch/snapshot/pick state bookkeeping and reducing divergence risk.","status":"closed","priority":1,"issue_type":"task","assignee":"Aditya Sharma","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:24.2582227-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T06:52:55.5255527-08:00","closed_at":"2026-02-17T06:52:55.5255527-08:00","close_reason":"Finalize DONE -> closed after verification pass.","labels":["refactor","tui"],"dependencies":[{"issue_id":"ouroboros-2.1","depends_on_id":"ouroboros-2","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-2.2","title":"Extend core/live-run-state.ts with missing shared transitions/selectors","description":"Move non-renderer-specific state mutations/selectors into shared live-run-state module.","notes":"Implemented shared live-run state selectors and transition helper in core/live-run-state.ts: added header/agent selector APIs and setStatus transition to centralize non-renderer state derivation and status updates.","status":"closed","priority":0,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:24.8542979-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:26:47.6437501-08:00","closed_at":"2026-02-17T01:26:47.6437501-08:00","labels":["refactor","tui"],"dependencies":[{"issue_id":"ouroboros-2.2","depends_on_id":"ouroboros-2","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-2.2","depends_on_id":"ouroboros-2.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-2.3","title":"Refactor core/terminal-ui.ts to consume shared live-run-state","description":"Switch ANSI renderer to shared model APIs and remove duplicate state logic.","notes":"Done: terminal-ui now uses LiveRunStateStore.getHeaderState() and getAgentSelector() for header/agent rendering; duplicated state branching removed from render path.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:25.4223906-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:34:46.4253543-08:00","closed_at":"2026-02-17T01:34:42.8945154-08:00","close_reason":"Refactor complete: core/terminal-ui now uses shared live-run-state selectors and no longer maintains duplicate loop/agent render state.","labels":["refactor","tui"],"dependencies":[{"issue_id":"ouroboros-2.3","depends_on_id":"ouroboros-2","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-2.3","depends_on_id":"ouroboros-2.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-2.4","title":"Refactor tui/tui.tsx to consume shared live-run-state","description":"Switch Ink renderer to shared model APIs and remove duplicate state logic.","notes":"PLAN: migrate tui/tui.tsx rendering path to consume LiveRunStateStore selectors + shared header/agent state, remove local loop/agent state branching, keep parity for spinner, status text/tone, and launch labels without changing output shape.\nSUMMARY: tui/tui.tsx now uses LiveRunStateStore header/agent selectors for Ink rendering. Removed direct loop-phase and spawn-state branching from render path; header uses getHeaderState() and agent cards use getAgentSelector(). Also removed local spinner/frame handling and kept existing shape for header, summary, run context, beads, and preview rows.","status":"closed","priority":1,"issue_type":"task","assignee":"Aditya Sharma","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:26.0396397-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:37:45.2894676-08:00","closed_at":"2026-02-17T01:37:45.2894676-08:00","close_reason":"Implemented Ink TUI refactor to consume shared live-run-state selectors; removed duplicate state derivation logic; preserved existing render shape.","labels":["refactor","tui"],"dependencies":[{"issue_id":"ouroboros-2.4","depends_on_id":"ouroboros-2","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-2.4","depends_on_id":"ouroboros-2.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-2.5","title":"Renderer parity verification for shared live-run model","description":"Verify ANSI and Ink renderer parity for status, usage summaries, beads panel, and completion state.","notes":"Plan: run focused parity audit between ANSI and Ink renderers (status header, running ratio/progress text, usage summary, beads panel, completion/completion tone/state), then patch selector usage if mismatches found; summarize fixes in done notes.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:26.7048296-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:39:38.4930418-08:00","closed_at":"2026-02-17T01:39:38.4930418-08:00","close_reason":"Verified ANSI/Ink parity for shared live-run rendering state. Synced Ink summary ordering and no-preview detail rendering with terminal behavior; no blocking functional regressions found.","labels":["refactor","tui","verification"],"dependencies":[{"issue_id":"ouroboros-2.5","depends_on_id":"ouroboros-2","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-2.5","depends_on_id":"ouroboros-2.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-2.5","depends_on_id":"ouroboros-2.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-3","title":"Medium: Split loop-engine by concern","description":"loop-engine.ts is 572 LOC and combines iteration runner, output handling, signal/shutdown + parse paths. Split into iteration-runner, iteration-output, and shutdown-guard modules with behavior parity and bounded API.","notes":"Plan: validate open dependencies are closed, confirm loop-engine refactor scope is complete, then close bead with summary evidence from prior iterations; no runtime code edits expected.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:00:09.2297192-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:23:51.2299374-08:00","closed_at":"2026-02-17T02:23:51.2299374-08:00","close_reason":"Completed: split loop-engine by concern. Dependencies 3.1, 3.2, 3.3, 3.4, 3.5 are done and smoke-check behavior already validated.","labels":["refactor","loop-engine"],"dependencies":[{"issue_id":"ouroboros-3","depends_on_id":"ouroboros-3.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-3","depends_on_id":"ouroboros-3.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-3","depends_on_id":"ouroboros-3.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-3","depends_on_id":"ouroboros-3.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-3","depends_on_id":"ouroboros-3.5","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-3.1","title":"Extract run construction/log path helpers from core/loop-engine.ts","description":"Move run list building and log path plumbing into a dedicated module.","notes":"Plan: extract run construction + log path plumbing into new module(s) (core/paths.ts or dedicated loop-engine helper module), migrate loop-engine logic there, and keep behavior unchanged while improving separation. Next step: identify all run-list + log-path code in loop-engine.ts, move it with unit-safe helpers, update imports/usages, then verify no callers still compute these paths inline.\nCompleted extraction: added core/loop-runs.ts and moved \buildRuns, summarizeArgsForLog, and run-log directory resolution out of core/loop-engine.ts. loop-engine now relies on \buildRuns and \resolveRunLogDirectory from new module while preserving orchestration behavior.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:28.8067004-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:43:58.2562141-08:00","closed_at":"2026-02-17T01:43:58.2562141-08:00","close_reason":"Extracted run construction and log path helpers into new core/loop-runs.ts; loop-engine now delegates run/path setup and remains orchestration-focused for this stage.","labels":["refactor","loop-engine"],"dependencies":[{"issue_id":"ouroboros-3.1","depends_on_id":"ouroboros-3","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-3.2","title":"Extract iteration execution/output handling from core/loop-engine.ts","description":"Move iteration execution + output aggregation/parsing into dedicated module(s).","notes":"Completed by extracting runIteration and per-iteration aggregation/stop parsing into core/iteration-execution.ts. loop-engine now delegates execution + output parsing, reuses shared shouldStopFromProviderOutput, and still sets renderer/fail/retry/pause state from same data shape.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:29.5176324-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T06:52:37.0759942-08:00","closed_at":"2026-02-17T06:52:37.0759942-08:00","close_reason":"Converted DONE -> closed after extraction completion of iteration-execution module.","labels":["refactor","loop-engine"],"dependencies":[{"issue_id":"ouroboros-3.2","depends_on_id":"ouroboros-3","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-3.3","title":"Extract shutdown/signal guard logic from core/loop-engine.ts","description":"Move abort/signal/shutdown guard behavior into isolated module with clear API.","notes":"Plan: extract shutdown/signal guard behavior from core/loop-engine.ts into core/shutdown.ts helper(s), keep orchestration unchanged, preserve SIGINT/SIGQUIT/terminal signal handling semantics and loop stop/error logging. Add minimal integration tests if feasible.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:30.1398662-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:50:03.4126855-08:00","closed_at":"2026-02-17T01:50:03.4126855-08:00","close_reason":"Implemented shutdown/signal guard extraction into shared helper (core/shutdown.ts) and wired loop orchestration in core/loop-engine.ts to consume installLoopShutdownGuard. Behavior preserved for SIGINT/SIGTERM cleanup and loop break conditions; finalizer now handles terminal cleanup of active spinners/processes.","labels":["refactor","loop-engine"],"dependencies":[{"issue_id":"ouroboros-3.3","depends_on_id":"ouroboros-3","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-3.4","title":"Reduce core/loop-engine.ts to orchestration-only entrypoint","description":"Keep loop-engine focused on orchestration wiring after extractions; preserve behavior parity.","notes":"Plan: make loop-engine pure orchestration by extracting non-core control helpers (renderer/progress/status utilities and iteration decision blocks) into a new core/orchestration module, then keep runLoop as delegation + lifecycle wiring, keeping behavior and exported contract stable.\nCompleted extraction: core/loop-engine.ts now only wires paths, shutdown, and renderer stop; core/loop-controller.ts owns loop orchestration body. Also preserved shouldStopFromProviderOutput re-export contract and moved preview/snapshot helper logic out without behavior changes.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:30.8062544-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:57:22.4097177-08:00","closed_at":"2026-02-17T01:57:22.4097177-08:00","close_reason":"Refactor completed: loop-engine is now orchestration-only entrypoint and execution flow moved to loop-controller.","labels":["refactor","loop-engine"],"dependencies":[{"issue_id":"ouroboros-3.4","depends_on_id":"ouroboros-3","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-3.4","depends_on_id":"ouroboros-3.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-3.4","depends_on_id":"ouroboros-3.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-3.4","depends_on_id":"ouroboros-3.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-3.5","title":"Loop-engine refactor smoke-check (doctor + loop run)","description":"Run doctor and a short loop smoke-run to verify refactor parity.","notes":"Plan: run bun run doctor, capture output; then execute a short, deterministic loop smoke run (non-interactive, bounded iterations) using existing CLI entrypoints and default providers; record parity issues if any. No code changes planned unless smoke-check reveals regression.\nSummary: ran bun run doctor then executed bounded loop smoke run via temporary no-op provider script. Loop launched with CLI parsing, state/load, live rendering fallback, iteration aggregation, preview parsing, and stop-marker handling. Result: stop marker detected cleanly and run terminated at iteration 3/10. Learnings: command resolved to .ai_agents/iteration.json run-state path; stale iteration state can block new runs unless iterations are bumped. Challenge: run state file currently shared with this workspace state tracking, so --iterations must be > current_iteration when reused.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:31.4150623-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:59:48.0760041-08:00","closed_at":"2026-02-17T01:59:48.0760041-08:00","close_reason":"Smoke-check completed successfully: doctor pass + bounded iteration run with stop marker.","labels":["refactor","loop-engine","verification"],"dependencies":[{"issue_id":"ouroboros-3.5","depends_on_id":"ouroboros-3","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-3.5","depends_on_id":"ouroboros-3.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-4","title":"Medium: Extract platform/path helpers into shared paths.ts","description":"Home-dir and project-name/path sanitization duplicated in config.ts and cli.ts. Extract resolveHomeDir, sanitizeProjectName, and default log path builder into paths.ts to prevent drift across platforms (Windows/Linux/macOS).","notes":"Plan: verify all path/parsing work from children is complete, confirm no remaining duplicated home/project/log path logic outside paths.ts, then close bead with concise completion summary and notes.\nCompleted by verifying children 4.1-4.4 covered all platform/path extraction and usage updates. Confirmed remaining path logic uses resolveHomeDir/sanitizeProjectName/defaultLogDir from core/paths.ts in cli/config and docs/tests. No additional code changes needed this iteration.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:00:18.0257876-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T06:52:55.8489745-08:00","closed_at":"2026-02-17T06:52:55.8489745-08:00","close_reason":"Finalize DONE -> closed after verification pass.","labels":["refactor","platform"],"dependencies":[{"issue_id":"ouroboros-4","depends_on_id":"ouroboros-4.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-4","depends_on_id":"ouroboros-4.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-4","depends_on_id":"ouroboros-4.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-4","depends_on_id":"ouroboros-4.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-4.1","title":"Create core/paths.ts for home/project/log path helpers","description":"Add shared resolveHomeDir/sanitizeProjectName/defaultLogDir helpers for cross-platform behavior.","notes":"Plan: add new core/paths.ts with resolveHomeDir, sanitizeProjectName, and defaultLogDir helpers; keep behavior compatible with current CLI/config defaults and avoid touching consumer files yet (blocked by child beads 4.2/4.3).","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:33.1239735-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:02:15.4172607-08:00","closed_at":"2026-02-17T02:02:15.4172607-08:00","close_reason":"Implemented shared path helper module: core/paths.ts with resolveHomeDir, sanitizeProjectName, and defaultLogDir; no consumer migrations included by design, kept behavior unchanged for default formats.","labels":["refactor","platform"],"dependencies":[{"issue_id":"ouroboros-4.1","depends_on_id":"ouroboros-4","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-4.2","title":"Refactor core/config.ts to use core/paths.ts helpers","description":"Remove duplicated path/home logic from config loader by importing shared helpers.","notes":"Plan: migrate all duplicate home/project/log path logic in core/config.ts to shared core/paths.ts helpers, preserving behavior and minimal surface changes.","status":"closed","priority":1,"issue_type":"task","assignee":"Aditya Sharma","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:33.7531211-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:04:51.3788146-08:00","closed_at":"2026-02-17T02:04:51.3788146-08:00","close_reason":"Completed: config now uses shared paths helpers for home resolution and project key sanitization via resolveHomeDir/sanitizeProjectName; behavior preserved.","labels":["refactor","platform"],"dependencies":[{"issue_id":"ouroboros-4.2","depends_on_id":"ouroboros-4","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-4.2","depends_on_id":"ouroboros-4.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-4.3","title":"Refactor core/cli.ts to use core/paths.ts helpers","description":"Remove duplicated path/home logic from CLI arg parsing by importing shared helpers.","notes":"Plan: migrate core/cli.ts path and home-resolution logic to use core/paths.ts helpers (resolveHomeDir, sanitizeProjectName, defaultLogDir), keeping behavior identical across Windows/Linux/macOS; remove duplicated path code and run quick diff sanity check.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:34.3660701-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:06:17.8467654-08:00","closed_at":"2026-02-17T02:06:17.8467654-08:00","close_reason":"Refactor done: CLI now uses shared core/paths helpers for log dir resolution while preserving CLI behavior.","labels":["refactor","platform"],"dependencies":[{"issue_id":"ouroboros-4.3","depends_on_id":"ouroboros-4","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-4.3","depends_on_id":"ouroboros-4.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-4.4","title":"Cross-platform parity check for home resolution and default logDir","description":"Verify Windows/Linux/macOS expectations for HOME and default log path behavior.","notes":"Completed with code+tests: resolveHomeDir now checks HOME, USERPROFILE, HOMEDRIVE+HOMEPATH, then homedir; docs updated in docs/config.md to reflect parity behavior; defaultLogDir behavior covered in new unit test file with cross-platform path assertions. Lesson: keep fallback ordering explicit; no runtime issues found. Challenge: Windows path-variable combinations not directly executable on non-Windows CI, so coverage is environment-conditional by actual platform.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:35.0336706-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:08:35.9915036-08:00","closed_at":"2026-02-17T02:08:15.3847759-08:00","close_reason":"Cross-platform home resolution covered with HOME, USERPROFILE, HOMEDRIVE/HOMEPATH fallback and docs/test updates for default log dir behavior.","labels":["refactor","platform","verification"],"dependencies":[{"issue_id":"ouroboros-4.4","depends_on_id":"ouroboros-4","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-4.4","depends_on_id":"ouroboros-4.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-4.4","depends_on_id":"ouroboros-4.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-5","title":"Low: Add shared JSON parsing helpers module","description":"JSON parse helpers are duplicated in state.ts, beads.ts, and config.ts. Create shared json.ts utility and replace duplicates; include safe parse + diagnostic behavior expected by current callers.","notes":"Plan: verify shared core/json.ts adoption completion across state/beads/config, then run malformed JSON smoke-check (bead 5.4) and close with evidence in notes.","status":"closed","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:00:25.0639412-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:29:50.6423072-08:00","closed_at":"2026-02-17T02:29:50.6423072-08:00","close_reason":"Completed shared JSON helpers adoption verification by adding malformed JSON smoke tests (iteration state + beads snapshot parse guard), matching child bead 5.4 completion.","labels":["refactor","util"],"dependencies":[{"issue_id":"ouroboros-5","depends_on_id":"ouroboros-5.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-5","depends_on_id":"ouroboros-5.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-5","depends_on_id":"ouroboros-5.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-5.1","title":"Create core/json.ts shared safe-parse helpers","description":"Add shared JSON parse helpers for tolerant parsing and object coercion used by core modules.","notes":"Plan: add core/json.ts shared safe parse helpers and migrate state/beads callsites; keep behavior and error handling unchanged; add tests for new shared helpers.","status":"closed","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:36.7412232-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:11:41.6074207-08:00","closed_at":"2026-02-17T02:11:41.6074207-08:00","close_reason":"Created shared JSON helper module and added tests; behavior unchanged for malformed JSON and object checks; follow-up migration remains in 5.2/5.3","labels":["refactor","util"],"dependencies":[{"issue_id":"ouroboros-5.1","depends_on_id":"ouroboros-5","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-5.2","title":"Migrate core/state.ts and core/beads.ts to core/json.ts","description":"Replace duplicated local safeJsonParse/asRecord helpers in state and beads modules.","notes":"Plan: migrate core/state.ts and core/beads.ts to import safeJsonParse/isRecord/toRecord from core/json.ts; remove duplicate local helpers; keep behavior and types unchanged; then add minimal targeted adjustments/tests if needed.","status":"closed","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:37.3871354-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:16:49.824982-08:00","closed_at":"2026-02-17T02:16:49.824982-08:00","close_reason":"Done: migrated state.ts and beads.ts to shared core/json.ts helpers. Removed local safeJsonParse/isObject/asRecord duplicates, switched state normalization to isRecord and beads parsing/extraction to toRecord + shared safeJsonParse. Behavior preserved. Added no new functionality, only dedupe.","labels":["refactor","util"],"dependencies":[{"issue_id":"ouroboros-5.2","depends_on_id":"ouroboros-5","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-5.2","depends_on_id":"ouroboros-5.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-5.3","title":"Migrate remaining core JSON helper callsites to core/json.ts","description":"Consolidate other core-side JSON parsing helpers where behavior aligns.","notes":"Plan: migrate remaining core JSON parsing helpers to shared core/json.ts in core/config.ts and any other core modules still using local duplicate safe-parse/record helpers; preserve behavior and avoid scope creep.","status":"closed","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:38.017301-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:18:03.5371717-08:00","closed_at":"2026-02-17T02:18:03.5371717-08:00","close_reason":"Migrated remaining core JSON helper usage in core/config.ts to shared core/json.ts (isRecord). Removed local duplicate and preserved parser behavior.","labels":["refactor","util"],"dependencies":[{"issue_id":"ouroboros-5.3","depends_on_id":"ouroboros-5","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-5.3","depends_on_id":"ouroboros-5.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-5.4","title":"Malformed JSON behavior smoke-check for shared core/json.ts adoption","description":"Verify error-tolerant behavior parity for malformed JSON inputs across migrated modules.","notes":"Plan: add targeted malformed JSON smoke-checks around shared core/json helpers via existing core/json.test.ts, then run bun test for the module to verify no regression and parity with legacy behavior expectations; close bead after test coverage commit.\nPlan: add malformed JSON smoke-check focused on shared json parser behavior used by core modules; create/extend core/json.test.ts for safeJsonParse and isRecord invalid input behavior; run no runtime smoke requiring external network, only focused test file; keep changes minimal to maintain current helper contracts.","status":"closed","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:53.8499266-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:29:47.1205289-08:00","closed_at":"2026-02-17T02:29:47.1205289-08:00","close_reason":"Closed after adding malformed JSON smoke-checks in core/json.test.ts: malformed iteration state recovers with defaults and malformed bd list output yields empty available snapshot.","labels":["refactor","util","verification"],"dependencies":[{"issue_id":"ouroboros-5.4","depends_on_id":"ouroboros-5","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-5.4","depends_on_id":"ouroboros-5.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-5.4","depends_on_id":"ouroboros-5.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-6","title":"Decision: Provider adapters should be thin wrappers over shared parser utilities","description":"Do shared parsing in parsing.ts/retry.ts as generic, normalization-first utilities. Keep adapters thin: raw transport parsing + domain-shape mapping. Allow adapter-local handling only for truly provider-unique edge cases (e.g., message envelope/layout differences) behind small adapter-specific normalization hooks.","status":"closed","priority":1,"issue_type":"decision","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:00:38.1134007-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:14:30.916694-08:00","closed_at":"2026-02-17T02:14:30.916694-08:00","close_reason":"Decision adoption completed via ouroboros-6.2; provider boundary decision now linked to refactor beads and implementation closed.","labels":["decision","provider"],"dependencies":[{"issue_id":"ouroboros-6","depends_on_id":"ouroboros-6.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-6","depends_on_id":"ouroboros-6.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-6","depends_on_id":"ouroboros-6.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-6.1","title":"Document provider adapter boundary decision in docs","description":"Capture thin-adapter + shared-parser boundary and edge-case policy in project docs.","notes":"Plan: add a concise docs section describing provider adapter as thin wrappers over shared parsers, where adapters own command invocation/transport and all parsing/retry/no-bead logic lives in shared modules; update any existing architecture/decision docs plus provider notes and include rationale + examples.\nPlan: document provider adapter boundary as thin transport wrappers over shared parsing/retry/no-bead helpers. Update architecture docs + provider readme references with policy and example ownership matrix; call out edge cases (stderr JSON, malformed payloads, rate-limit retry, no-beads markers).\nSummary: added docs/provider-adapter-boundary.md with thin adapter + shared parsing/retry ownership decision, and linked it from docs/README.md. No code behavior changes; no blockers encountered.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:40.3813794-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:11:58.0259948-08:00","closed_at":"2026-02-17T02:11:39.6399003-08:00","close_reason":"Completed adapter boundary documentation work: linked provider boundary decision from README and expanded docs/provider-adapter-boundary.md with explicit ownership rules plus good/bad examples; behavior remains unchanged; no code paths modified.","labels":["decision","provider","docs"],"dependencies":[{"issue_id":"ouroboros-6.1","depends_on_id":"ouroboros-6","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-6.2","title":"Apply decision links to provider refactor beads and close decision","description":"Link decision artifacts to provider refactor tasks and close decision when adoption lands.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:41.0018186-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T02:14:30.301255-08:00","closed_at":"2026-02-17T02:14:30.301255-08:00","close_reason":"Decision-links are now explicit in docs/provider-adapter-boundary.md, with provider refactor bead references for adoption traceability.","labels":["decision","provider"],"dependencies":[{"issue_id":"ouroboros-6.2","depends_on_id":"ouroboros-6","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-6.2","depends_on_id":"ouroboros-6.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}],"comments":[{"id":1,"issue_id":"ouroboros-6.2","author":"Aditya Sharma","text":"Plan: link decision docs/spec references from 6.1 into provider refactor bead notes (ouroboros-1,5.x,6.x), then close ouroboros-6.2 and ouroboros-6 if dependencies clear.","created_at":"2026-02-17T02:14:02.9847483-08:00"},{"id":2,"issue_id":"ouroboros-6.2","author":"Aditya Sharma","text":"Done: added decision/refactor references in docs/provider-adapter-boundary.md; next step closed this bead and can unblock decision ouroboros-6.","created_at":"2026-02-17T02:14:30.5632949-08:00"}]}
{"id":"ouroboros-6.3","title":"Document provider adapter boundary decision in docs","description":"Capture thin-adapter + shared-parser boundary and edge-case policy in project docs.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:55.4329361-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:04:21.5871435-08:00","closed_at":"2026-02-17T01:04:21.5871435-08:00","labels":["decision","provider","docs"],"dependencies":[{"issue_id":"ouroboros-6.3","depends_on_id":"ouroboros-6","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-6.4","title":"Apply decision links to provider refactor beads and close decision","description":"Link decision artifacts to provider refactor tasks and close decision when adoption lands.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T01:03:55.7963362-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T01:04:21.8543502-08:00","closed_at":"2026-02-17T01:04:21.8543502-08:00","labels":["decision","provider"],"dependencies":[{"issue_id":"ouroboros-6.4","depends_on_id":"ouroboros-6","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-6.4","depends_on_id":"ouroboros-6.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-7","title":"Feature: optional slot-local review/fix loop after implementation","description":"Add optional review mode per agent slot: after implementation, run reviewer; if drift, run fix agent with reviewer follow-up prompt; repeat review->fix up to 5 fix attempts; fail iteration if unresolved drift. Reviewer is prompt-only and must emit strict JSON verdict.","notes":"Decisions: maxFixAttempts=5; unresolved drift fails iteration; reviewer cannot edit code; reviewer output contract JSON {verdict: pass|drift, followUpPrompt}; reviewer context includes bead + logs + git diff with warning about unrelated parallel-agent changes; review/fix uses developer config for execution options; review uses optional separate prompt file; stop-marker detection only from implement/fix outputs; slot-local pipeline with parallel slots.","status":"open","priority":1,"issue_type":"feature","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:11:07.5612168-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:11:07.5612168-08:00","labels":["loop-engine","review","agents"],"dependencies":[{"issue_id":"ouroboros-7","depends_on_id":"ouroboros-7.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7","depends_on_id":"ouroboros-7.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7","depends_on_id":"ouroboros-7.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7","depends_on_id":"ouroboros-7.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7","depends_on_id":"ouroboros-7.5","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7","depends_on_id":"ouroboros-7.6","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-7.1","title":"Add review/developer runtime config schema and CLI flags","description":"Extend runtime options with review toggles and fix-attempt cap; remove required single prompt model and support optional developer/reviewer prompt paths with defaults.","notes":"Plan: 1) Add review config fields to CliOptions type. 2) Extend normalizeConfigRecord + mergeConfig in config.ts. 3) Add CLI flags. 4) Wire through parseArgs. 5) Update printUsage. 6) Run doctor.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:11:18.5345668-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:20:47.1865146-08:00","closed_at":"2026-02-17T07:20:47.1865146-08:00","close_reason":"Added reviewEnabled, reviewMaxFixAttempts, developerPromptPath, reviewerPromptPath to CliOptions type, TOML config normalization, CLI flag parsing with precedence, usage text, and docs/config.md.","labels":["config","cli","review"],"dependencies":[{"issue_id":"ouroboros-7.1","depends_on_id":"ouroboros-7","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-7.2","title":"Introduce prompt directory defaults and optional prompt-file resolution","description":"Create/standardize prompt defaults under .ai_agents/prompts and make developer/reviewer prompt file paths optional with clear fallback order.","notes":"Defaults: .ai_agents/prompts/developer.md and .ai_agents/prompts/reviewer.md. Remove hard requirement on .ai_agents/prompt.md. Preserve cross-platform path resolution behavior.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:11:25.0081123-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:45:18.9001857-08:00","closed_at":"2026-02-17T07:45:18.9001857-08:00","close_reason":"Prompt directory defaults and role-based prompt resolution implemented. core/prompts.ts with fallback chain (explicit > .ai_agents/prompts/{role}.md > legacy), wired in loop-engine startup, 13 tests, docs updated, doctor clean.","labels":["prompts","config"],"dependencies":[{"issue_id":"ouroboros-7.2","depends_on_id":"ouroboros-7","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.2","depends_on_id":"ouroboros-7.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}],"comments":[{"id":1,"issue_id":"ouroboros-7.2","author":"Aditya Sharma","text":"Plan: 1) Create .ai_agents/prompts/ directory structure with developer.md and reviewer.md defaults. 2) Add resolvePromptPath helper in core/prompts.ts for fallback chain: explicit path > .ai_agents/prompts/{role}.md > .ai_agents/prompt.md (legacy). 3) Update loop-engine.ts to resolve developer prompt via new helper. 4) Wire reviewerPromptPath resolution for future use by 7.3/7.4. 5) Update docs/config.md with prompt defaults section. 6) Run doctor.","created_at":"2026-02-17T07:22:02.3914178-08:00"},{"id":2,"issue_id":"ouroboros-7.2","author":"Aditya Sharma","text":"Plan: 1) Create core/prompts.ts with resolvePromptPath helper that implements fallback: explicit path > .ai_agents/prompts/{role}.md > .ai_agents/prompt.md (legacy). 2) Update cli.ts to use new resolver for promptPath/developerPromptPath/reviewerPromptPath defaults. 3) Update loop-engine.ts to resolve developer prompt via new helper. 4) Update docs/config.md with prompt directory structure and fallback order. 5) Run doctor.","created_at":"2026-02-17T07:22:28.980939-08:00"}]}
{"id":"ouroboros-7.3","title":"Add reviewer verdict contract parser and follow-up prompt builder","description":"Implement strict reviewer verdict parsing and prompt composition for review/fix cycle.","notes":"Plan: 1) Create core/review.ts with ReviewVerdict type, parseReviewerVerdict parser (strict JSON {verdict: pass|drift, followUpPrompt: string}), and buildReviewerContext helper (bead metadata + implementer output/logs + git diff + parallel-agent warning). 2) Add core/review.test.ts with coverage for valid pass/drift, malformed JSON, missing fields, empty/null. 3) Run doctor.","status":"closed","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:11:40.5980435-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:49:13.3137497-08:00","closed_at":"2026-02-17T07:49:13.3137497-08:00","close_reason":"Added core/review.ts with strict ReviewVerdict parser (pass/drift JSON contract with followUpPrompt), type guards (isReviewResult/isReviewFailure), and buildReviewerContext helper. Context includes bead metadata, implementer output, git diff, parallel-agent warning, and fix-attempt history. 24 tests in core/review.test.ts covering valid/invalid/malformed inputs. Doctor clean.","labels":["review","loop-engine"],"dependencies":[{"issue_id":"ouroboros-7.3","depends_on_id":"ouroboros-7","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.3","depends_on_id":"ouroboros-7.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-7.4","title":"Integrate slot-local implement->review->fix loop in iteration execution","description":"Change per-slot execution flow to run review/fix attempts after implementation when review is enabled.","notes":"Per slot: implement, then review; on drift run fix with reviewer follow-up prompt; re-review up to reviewMaxFixAttempts (default 5). If drift unresolved after cap, mark slot failed and fail iteration. Keep staged slot launching and parallel slot behavior.","status":"closed","priority":0,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:11:46.646741-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:57:57.2447612-08:00","closed_at":"2026-02-17T07:57:57.2447612-08:00","close_reason":"Integrated slot-local implement->review->fix loop in iteration-execution.ts. runSlotReviewLoop handles per-slot review/fix pipeline: runs reviewer with buildReviewerContext, parses strict JSON verdict, loops fix->review up to maxFixAttempts. Unresolved drift fails slot/iteration. Stop-marker detection excluded from reviewer output. Staged launch and parallel behavior unchanged. Doctor clean, 65 tests pass.","labels":["loop-engine","review"],"dependencies":[{"issue_id":"ouroboros-7.4","depends_on_id":"ouroboros-7","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.4","depends_on_id":"ouroboros-7.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.4","depends_on_id":"ouroboros-7.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.4","depends_on_id":"ouroboros-7.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}],"comments":[{"id":1,"issue_id":"ouroboros-7.4","author":"Aditya Sharma","text":"Starting work: integrate slot-local implement->review->fix loop in iteration-execution.ts. Plan: 1) Add a runSlotWithReview wrapper that takes a single slot's implement result, runs reviewer with buildReviewerContext, parses verdict, and loops fix->review up to maxFixAttempts. 2) Wire it into the existing runIteration flow after each agent completes. 3) Keep stop-marker detection only on implement/fix outputs. 4) Keep staged launch behavior unchanged. 5) Run doctor + existing tests.","created_at":"2026-02-17T07:50:39.4615319-08:00"}]}
{"id":"ouroboros-7.5","title":"Constrain stop-marker/failure semantics and add review/fix logs and phases","description":"Ensure stop-marker detection and lifecycle state remain correct with review enabled.","notes":"Only implementation/fix outputs participate in stop-marker and usage aggregation; reviewer output is excluded. Add deterministic per-pass review/fix log files and lifecycle notices/phases for reviewing and fixing in rich and non-rich modes.","status":"in_progress","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:11:52.7942088-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:59:28.4886603-08:00","labels":["loop-engine","tui","logging"],"dependencies":[{"issue_id":"ouroboros-7.5","depends_on_id":"ouroboros-7","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.5","depends_on_id":"ouroboros-7.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}],"comments":[{"id":1,"issue_id":"ouroboros-7.5","author":"Aditya Sharma","text":"Starting work: constrain stop-marker/failure semantics and add review/fix logs and phases. Plan: 1) Add per-pass review/fix log files (deterministic naming). 2) Add reviewing/fixing lifecycle phases to LiveRunStateStore. 3) Surface review/fix phases in both ANSI and Ink renderers. 4) Ensure stop-marker detection excludes reviewer output (already done in 7.4, verify). 5) Run doctor + tests.","created_at":"2026-02-17T07:59:29.2683503-08:00"}]}
{"id":"ouroboros-7.6","title":"Add regression tests and docs for optional review loop and prompt defaults","description":"Cover new review/fix loop behavior, contract validation, config/CLI parsing, and prompt fallback docs.","notes":"Add tests for: review disabled path, pass-on-first-review, drift then fix then pass, malformed reviewer JSON failure, cap at 5 fix attempts failure, and stop-marker exclusion for reviewer output. Update docs/README.md, docs/config.md, and docs/learned with lifecycle details.","status":"open","priority":1,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:11:59.5998848-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:11:59.5998848-08:00","labels":["tests","docs","review"],"dependencies":[{"issue_id":"ouroboros-7.6","depends_on_id":"ouroboros-7","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.6","depends_on_id":"ouroboros-7.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.6","depends_on_id":"ouroboros-7.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.6","depends_on_id":"ouroboros-7.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.6","depends_on_id":"ouroboros-7.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-7.6","depends_on_id":"ouroboros-7.5","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-8","title":"Refactor test file layout to keep .test.ts out of main code folders","description":"Reorganize repository structure so test files are not intermingled with production source files. Move existing *.test.ts files into dedicated test-focused locations (for example per-module __tests__ folders or a top-level tests tree) while preserving current test behavior and command ergonomics.","acceptance_criteria":"1) No *.test.ts files remain mixed beside production files in core/, providers/, tui/, and similar runtime directories unless intentionally justified. 2) Test runner still discovers and executes all tests without extra manual steps. 3) Imports/paths are updated so bun test and bun run doctor continue to work. 4) Docs mention the chosen test-folder convention.","status":"open","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:56:53.6464305-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:56:53.6464305-08:00","labels":["refactor","tests","repo-structure"]}
{"id":"ouroboros-8.1","title":"Define and document canonical test directory layout","description":"Choose the test organization convention (for example per-module __tests__ or top-level tests tree), define placement rules, and document migration boundaries before moving files.","acceptance_criteria":"1) One explicit convention selected for this repo. 2) Convention documented in docs/README or config docs with concrete path examples. 3) Exceptions policy defined for integration/smoke tests.","status":"open","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:57:27.3665463-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:57:27.3665463-08:00","labels":["tests","repo-structure","docs"],"dependencies":[{"issue_id":"ouroboros-8.1","depends_on_id":"ouroboros-8","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-8.2","title":"Move provider and TUI tests to dedicated test locations","description":"Relocate providers/*.test.ts and tui-related tests to the selected test layout and keep adapter/UI coverage intact.","acceptance_criteria":"1) Provider/TUI tests are no longer intermingled with production modules. 2) Discovery still works with bun test. 3) Provider/TUI targeted tests pass.","status":"open","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:57:27.7149945-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:57:27.7149945-08:00","labels":["tests","repo-structure","providers","tui"],"dependencies":[{"issue_id":"ouroboros-8.2","depends_on_id":"ouroboros-8","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-8.3","title":"Move core tests to dedicated test locations","description":"Relocate core/*.test.ts files to the chosen test layout and keep coverage behavior unchanged.","acceptance_criteria":"1) Core tests are moved out of runtime file adjacency per convention. 2) Import paths are fixed. 3) core test suite runs successfully.","status":"open","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:58:02.2453754-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:58:02.2453754-08:00","labels":["tests","repo-structure","core"],"dependencies":[{"issue_id":"ouroboros-8.3","depends_on_id":"ouroboros-8","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-8.3","depends_on_id":"ouroboros-8.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-8.4","title":"Update test imports and discovery after relocation","description":"Adjust relative imports and any runner/glob assumptions so moved tests are discovered consistently.","acceptance_criteria":"1) No broken imports from moved test files. 2) bun test discovers relocated tests with no manual path list maintenance. 3) No runtime source module path churn beyond what test relocation requires.","status":"open","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:58:08.6428294-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:58:08.6428294-08:00","labels":["tests","tooling","repo-structure"],"dependencies":[{"issue_id":"ouroboros-8.4","depends_on_id":"ouroboros-8","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-8.4","depends_on_id":"ouroboros-8.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-8.4","depends_on_id":"ouroboros-8.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"ouroboros-8.5","title":"Verify relocation and document test-structure convention","description":"Run validation and update docs to lock the new test layout convention for future contributors.","acceptance_criteria":"1) bun run doctor completed (or clearly reported blocker). 2) Relevant test suites pass after relocation. 3) Docs updated with canonical test folder policy and examples.","status":"open","priority":2,"issue_type":"task","owner":"adityaksharma@gmail.com","created_at":"2026-02-17T07:58:16.4841205-08:00","created_by":"Aditya Sharma","updated_at":"2026-02-17T07:58:16.4841205-08:00","labels":["tests","verification","docs"],"dependencies":[{"issue_id":"ouroboros-8.5","depends_on_id":"ouroboros-8","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"ouroboros-8.5","depends_on_id":"ouroboros-8.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
